## 级联

mappers支持`relationship()`构造器的级联可配置概念。意思就是对一个一个父对象执行某个操作后会如何影响到它的子对象，通过`relationship.cascade`来影响。

默认的级联行为只包括`sava_update`和`merge`。一般需要使用的级联还包括`delete`和`delete-orphan`。

级联行为通过`relationship()`的`cascade`来配置：

```python
class Order(Base):
    __tablename__ = 'order'

    items = relationship("Item", cascade="all delete-orphan")
    customer = relationsihp("User", cascade="save_update")
```

想要为一个反向引用设置一个backref，可以使用`backref()`函数：

```python
class Item(Base):
    __tablename__ = 'item'

    order = relationship('Order', 
                        backref=backref('items', cascade='all, delete-orphan'))
```

cascade的默认值是`sava-update, merge`。一般使用这个选项的参数值是`all`或者`all, delete-orphan`。`all`代表`sava-update, merge, refresh-expire, expunge, delete`的合称，`delete-orphan`代表子对象应该永远跟随父对象，如果失去关联，则会删除这个对象。

### save-update

`save-update`级联指的是，当一个对象通过`Session.add()`放入`Session`中时，所有和它关联的对象都应该被加入到Session中。假定我们有一个对象`user1`，它有两个关联对象`address1, address2`：

```python
>>> user1 = User()
>>> address1, address2 = Address(), Address()
>>> user1.addresses = [address1, address2]
```

如果我们将user1加入到Session，同样会隐式地将address1, address2一并加入：

```python
>>> sess = Session()
>>> sess.add(user1)
>>> address1 in sess
True
```

save-update同样会影响到已经存在于Session中对象的属性操作。如果我们加入第三个对象，`address3`加入到`user1.addresses`集合，它将会变为Session的一部分：

```python
>>> address3 = Address()
>>> user1.append(address3)
>>> address3 in sess
True
```

save-update有时可能会有让人惊讶的行为，比如一个持久对象从每个集合中移除，有时一个scalar属性同样会推入到父对象所在的Session；这是为什么刷新操作可以正确的处理关联对象。例子：

```python
>>> user1 = sess1.query(User).filter_by(id=1).first()
>>> address1 = user1.addresses[0]
>>> sess.close()
>>> user1.addresses.remove(address1)
>>> sess2 = Session()
>>> sess2.add(user1)
>>> address1 in sess2
True
```

`save-update`是默认级联。这个级联可以禁用，但是通常不需要这样做。

### delete

pass