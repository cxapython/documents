## 字符串和正则表达式

字符串无疑是编程中最重要的数据类型之一.作为扩展，正则表达式也是很重要的，因为它让开发者可以更加高效的控制字符串.ECMAScript6通过为字符串和正则表达式增加新的能力和缺失多年的功能来改进它们.

### Unicode支持

#### UTF-16 Code Points

##### Understanding ECMAScript6

*《understanding es6: string and regular expressions》*

在ES6之前，JavaScript假定每个字符都是16bit的字节序列，也叫作`code unit`。所有的字符串属性和方法，像`length`属性和`charAt()`方法，都是基于这个16bit`code unit`创建。


16位unicode不能让全世界每个字符都具有全局唯一标识符(globally unique identifiers)。Unicode全局唯一标识符也叫做`code points`，是以0开始的数字。

UTF-16中的首个2<sup>16</sup>`code points`会代表一个16-bit`code units`.这个范围叫做`Basic Multilingual Plane(BMP)`。所有超出这个范围的都叫做`supplementary planes`.UTF-16解决不能用16bits代表的字符使用的办法是：引入`surrogate pair`来代表两个16bit的`code units`.

在ES5中，所有的字符串操作都基于16bit`code units`。意味着你的UTF-16编码字符串如果包含`surrogate pair`，你对它的操作可能会获得意外的结果:

```javascript
let text = "𠮷";

console.log(text.length);        // 2
console.log(/^.$/.test(text));   // false
console.log(text.charAt(0));     // ""
console.log(text.charAt(1));     // ""
console.log(text.charCodeAt(0)); // 55362
console.log(text.charCodeAt(1)); // 57271
```


##### ECMAScript6入门

*《ECMAScript6入门: 字符串的扩展》*

Javascript允许`\uxxxx`形式表示一个字符，其中`uuuu`表示字符的Unicode码点(code point).

```javascript
"\u0061"
// "a"
```

但是，这种表示法仅限于码点在`\u0000 ~ \uFFFF`之间的字符。超出这个范围的字符，必须用双字节的形式来表示。

```javascript
"\uD842\uDFB7"
// "𠮷"

"\u20BB7"
// " 7"
```

上面的代码表示，如果直接在`\u`后面跟上超过`0xFFFF`的数值(比如`\u20BB7`)，JavaScript会理解为`\u20BB+7`。由于`\u20BB`是一个不可打印字符，所以只会显式一个空格，后面跟着一个7。

ES6在这一点上面作出了改进，只要将码点被两个大括号包裹，就能正常解读该字符。

```javascript
"\u{20BB7}"
// "𠮷"

"\u{41}\u{42}\u{43}"
// "ABC"

let hello = 123;
hell\u{6F} // 123

'\u{1F680}' === '\uD83D\uDE80'
// true
```

上面代码中，最后一个例子表明，大括号表示法和四子节的UTF-16编码是等价的.

有了这种方法之后，JavaScript共有6中方法可以表示一个字符：

```javascript
'\z' === 'z'  // true
'\172' === 'z' // true
'\x7A' === 'z' // true
'\u007A' === 'z' // true
'\u{7A}' === 'z' // true
```


