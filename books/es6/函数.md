[TOC]

## 函数

### 函数参数的默认值

#### ES6入门

ES6之前，不能直接为函数的参数指定默认值，只能采用变通的方法：

```javascript
function log(x, y) {
    y = y || 'World';
    console.log(x, y);
}

log('Hello')            // Hello World
log('Hello', 'China')   // Hello China
log('Hello', '')        // Hello World
```

但是这种方法会碰到鸭子类型的问题，所以如果有严格需求那么要判断一下`y`是否被赋值:

```javascript
if (typeof y === 'undefined') {
    y = 'World';
}
```

到了ES6，允许为函数的参数设置默认值：

```javascript
function log(x, y = 'World') {
    console.log(x, y);
}

log('Hello')            // Hello World
log('Hello', 'China')   // Hello China
log('Hello', '')        // Hello
```

参数变量是默认声明的，所以不能用`let`或`const`再次声明:

```javascript
function foo(x = 5) {
    let x = 1;      // error
    const x = 2;    // error
}
```

另外，使用默认参数时，函数不能包含同名参数:

```javascript
// 不报错
function foo(x, x, y) {
    // ...
}

// 报错
function foo(x, x, y = 1) {
    // ...
}

// SyntaxError: Duplicate parameter name not allowed in this context
```

另外，一个容易忽略的地方是，参数默认值不是传值(evaluated)的，而是每次都重新计算默认值表达式的值。也就是说，参数默认值是惰性求值的:

```javascript
let x = 99;
function foo(p = x + 1) {
    console.log(p);
}

foo()   // 100

x = 100;

foo()   // 101
```

上面代码中，参数`p`的默认值是`x + 1`。这时，每次调用函数`foo()`，都会重新计算`x + 1`，而不是默认`p = 100`.

